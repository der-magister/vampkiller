                                      1 ;--------------------------------------------------------
                                      2 ; File Created by SDCC : free open source ISO C Compiler
                                      3 ; Version 4.5.1 #15267 (Linux)
                                      4 ;--------------------------------------------------------
                                      5 	.module engine
                                      6 	
                                      7 ;--------------------------------------------------------
                                      8 ; Public variables in this module
                                      9 ;--------------------------------------------------------
                                     10 	.globl _set_sprite_data
                                     11 	.globl _set_bkg_tiles
                                     12 	.globl _set_bkg_data
                                     13 	.globl _p_engine_loadTileset
                                     14 	.globl _p_engine_loadSpriteset
                                     15 	.globl _p_engine_loadMap
                                     16 	.globl _p_engine_showMap
                                     17 	.globl _p_engine_calcCoord
                                     18 ;--------------------------------------------------------
                                     19 ; special function registers
                                     20 ;--------------------------------------------------------
                                     21 	.area _HRAM
                                     22 ;--------------------------------------------------------
                                     23 ; ram data
                                     24 ;--------------------------------------------------------
                                     25 	.area _DATA
                                     26 ;--------------------------------------------------------
                                     27 ; ram data
                                     28 ;--------------------------------------------------------
                                     29 	.area _INITIALIZED
                                     30 ;--------------------------------------------------------
                                     31 ; absolute external ram data
                                     32 ;--------------------------------------------------------
                                     33 	.area _DABS (ABS)
                                     34 ;--------------------------------------------------------
                                     35 ; global & static initialisations
                                     36 ;--------------------------------------------------------
                                     37 	.area _HOME
                                     38 	.area _GSINIT
                                     39 	.area _GSFINAL
                                     40 	.area _GSINIT
                                     41 ;--------------------------------------------------------
                                     42 ; Home
                                     43 ;--------------------------------------------------------
                                     44 	.area _HOME
                                     45 ;engine.c:33: void p_engine_loadTileset (uint8_t l_ftile, uint8_t l_ltile, unsigned char l_tileset [80]) __nonbanked
                                     46 ;	---------------------------------
                                     47 ; Function p_engine_loadTileset
                                     48 ; ---------------------------------
    00000000                         49 _p_engine_loadTileset::
    00000000 43               [ 4]   50 	ld	b, e
                                     51 ;engine.c:35: set_bkg_data (l_ftile, l_ltile + 1, l_tileset);
    00000001 04               [ 4]   52 	inc	b
    00000002 F8 02            [12]   53 	ldhl	sp,	#2
    00000004 5E               [ 8]   54 	ld	e, (hl)
    00000005 23               [ 8]   55 	inc	hl
    00000006 56               [ 8]   56 	ld	d, (hl)
    00000007 D5               [16]   57 	push	de
    00000008 C5               [16]   58 	push	bc
    00000009 33               [ 8]   59 	inc	sp
    0000000A F5               [16]   60 	push	af
    0000000B 33               [ 8]   61 	inc	sp
    0000000C CDr00r00         [24]   62 	call	_set_bkg_data
    0000000F E8 04            [16]   63 	add	sp, #4
                                     64 ;engine.c:36: }
    00000011 E1               [12]   65 	pop	hl
    00000012 F1               [12]   66 	pop	af
    00000013 E9               [ 4]   67 	jp	(hl)
                                     68 ;engine.c:44: void p_engine_loadSpriteset (uint8_t l_fsprite, uint8_t l_lsprite, unsigned char l_spriteset [5]) __nonbanked
                                     69 ;	---------------------------------
                                     70 ; Function p_engine_loadSpriteset
                                     71 ; ---------------------------------
    00000014                         72 _p_engine_loadSpriteset::
    00000014 43               [ 4]   73 	ld	b, e
                                     74 ;engine.c:46: set_sprite_data (l_fsprite, l_lsprite + 1, l_spriteset);
    00000015 04               [ 4]   75 	inc	b
    00000016 F8 02            [12]   76 	ldhl	sp,	#2
    00000018 5E               [ 8]   77 	ld	e, (hl)
    00000019 23               [ 8]   78 	inc	hl
    0000001A 56               [ 8]   79 	ld	d, (hl)
    0000001B D5               [16]   80 	push	de
    0000001C C5               [16]   81 	push	bc
    0000001D 33               [ 8]   82 	inc	sp
    0000001E F5               [16]   83 	push	af
    0000001F 33               [ 8]   84 	inc	sp
    00000020 CDr00r00         [24]   85 	call	_set_sprite_data
    00000023 E8 04            [16]   86 	add	sp, #4
                                     87 ;engine.c:47: }
    00000025 E1               [12]   88 	pop	hl
    00000026 F1               [12]   89 	pop	af
    00000027 E9               [ 4]   90 	jp	(hl)
                                     91 ;engine.c:50: void p_engine_loadMap (unsigned char l_lvldat [252]) __nonbanked
                                     92 ;	---------------------------------
                                     93 ; Function p_engine_loadMap
                                     94 ; ---------------------------------
    00000028                         95 _p_engine_loadMap::
    00000028 E8 FF            [16]   96 	add	sp, #-1
    0000002A D5               [16]   97 	push	de
                                     98 ;engine.c:54: for (l_i = 0; l_i != 253; ++l_i) v_lvldat [l_i] = l_lvldat [l_i];
    0000002B F8 02            [12]   99 	ldhl	sp,	#2
    0000002D 36 00            [12]  100 	ld	(hl), #0x00
    0000002F                        101 00102$:
    0000002F 11r00r00         [12]  102 	ld	de, #_v_lvldat
    00000032 F8 02            [12]  103 	ldhl	sp,	#2
    00000034 6E               [ 8]  104 	ld	l, (hl)
    00000035 26 00            [ 8]  105 	ld	h, #0x00
    00000037 19               [ 8]  106 	add	hl, de
    00000038 4D               [ 4]  107 	ld	c, l
    00000039 44               [ 4]  108 	ld	b, h
    0000003A D1               [12]  109 	pop	de
    0000003B D5               [16]  110 	push	de
    0000003C F8 02            [12]  111 	ldhl	sp,	#2
    0000003E 6E               [ 8]  112 	ld	l, (hl)
    0000003F 26 00            [ 8]  113 	ld	h, #0x00
    00000041 19               [ 8]  114 	add	hl, de
    00000042 5D               [ 4]  115 	ld	e, l
    00000043 54               [ 4]  116 	ld	d, h
    00000044 1A               [ 8]  117 	ld	a, (de)
    00000045 02               [ 8]  118 	ld	(bc), a
    00000046 F8 02            [12]  119 	ldhl	sp,	#2
    00000048 34               [12]  120 	inc	(hl)
    00000049 7E               [ 8]  121 	ld	a, (hl)
    0000004A D6 FD            [ 8]  122 	sub	a, #0xfd
    0000004C 20 E1            [12]  123 	jr	NZ, 00102$
                                    124 ;engine.c:55: }
    0000004E E8 03            [16]  125 	add	sp, #3
    00000050 C9               [16]  126 	ret
                                    127 ;engine.c:58: void p_engine_showMap (unsigned char l_lvldat [252]) __nonbanked
                                    128 ;	---------------------------------
                                    129 ; Function p_engine_showMap
                                    130 ; ---------------------------------
    00000051                        131 _p_engine_showMap::
                                    132 ;engine.c:60: set_bkg_tiles (1, 1, 18, 14, l_lvldat);
    00000051 D5               [16]  133 	push	de
    00000052 21 12 0E         [12]  134 	ld	hl, #0xe12
    00000055 E5               [16]  135 	push	hl
    00000056 21 01 01         [12]  136 	ld	hl, #0x101
    00000059 E5               [16]  137 	push	hl
    0000005A CDr00r00         [24]  138 	call	_set_bkg_tiles
    0000005D E8 06            [16]  139 	add	sp, #6
                                    140 ;engine.c:61: }
    0000005F C9               [16]  141 	ret
                                    142 ;engine.c:64: uint8_t p_engine_calcCoord (uint8_t l_w1, uint8_t l_w2) __nonbanked
                                    143 ;	---------------------------------
                                    144 ; Function p_engine_calcCoord
                                    145 ; ---------------------------------
    00000060                        146 _p_engine_calcCoord::
    00000060 E8 FA            [16]  147 	add	sp, #-6
    00000062 F8 05            [12]  148 	ldhl	sp,	#5
    00000064 73               [ 8]  149 	ld	(hl), e
                                    150 ;engine.c:66: return ((l_w1 - 16) / 8) + 18 * ((l_w2 - 24) / 8);
    00000065 F8 01            [12]  151 	ldhl	sp,	#1
    00000067 22               [ 8]  152 	ld	(hl+), a
    00000068 AF               [ 4]  153 	xor	a, a
    00000069 32               [ 8]  154 	ld	(hl-), a
    0000006A 2A               [ 8]  155 	ld	a, (hl+)
    0000006B 5F               [ 4]  156 	ld	e, a
    0000006C 56               [ 8]  157 	ld	d, (hl)
    0000006D 21 10 00         [12]  158 	ld	hl, #0x0010
    00000070 7B               [ 4]  159 	ld	a, e
    00000071 95               [ 4]  160 	sub	a, l
    00000072 5F               [ 4]  161 	ld	e, a
    00000073 7A               [ 4]  162 	ld	a, d
    00000074 9C               [ 4]  163 	sbc	a, h
    00000075 F8 04            [12]  164 	ldhl	sp,	#4
    00000077 32               [ 8]  165 	ld	(hl-), a
    00000078 73               [ 8]  166 	ld	(hl), e
    00000079 2A               [ 8]  167 	ld	a, (hl+)
    0000007A 4F               [ 4]  168 	ld	c, a
    0000007B 46               [ 8]  169 	ld	b, (hl)
    0000007C CB 7E            [12]  170 	bit	7, (hl)
    0000007E 28 0C            [12]  171 	jr	Z, 00103$
    00000080 2B               [ 8]  172 	dec	hl
    00000081 2B               [ 8]  173 	dec	hl
    00000082 2B               [ 8]  174 	dec	hl
    00000083 2A               [ 8]  175 	ld	a, (hl+)
    00000084 5F               [ 4]  176 	ld	e, a
    00000085 56               [ 8]  177 	ld	d, (hl)
    00000086 21 F7 FF         [12]  178 	ld	hl, #0xfff7
    00000089 19               [ 8]  179 	add	hl, de
    0000008A 4D               [ 4]  180 	ld	c, l
    0000008B 44               [ 4]  181 	ld	b, h
    0000008C                        182 00103$:
    0000008C CB 28            [ 8]  183 	sra	b
    0000008E CB 19            [ 8]  184 	rr	c
    00000090 CB 28            [ 8]  185 	sra	b
    00000092 CB 19            [ 8]  186 	rr	c
    00000094 CB 28            [ 8]  187 	sra	b
    00000096 CB 19            [ 8]  188 	rr	c
    00000098 F8 00            [12]  189 	ldhl	sp,	#0
    0000009A 71               [ 8]  190 	ld	(hl), c
    0000009B F8 05            [12]  191 	ldhl	sp,	#5
    0000009D 7E               [ 8]  192 	ld	a, (hl)
    0000009E F8 01            [12]  193 	ldhl	sp,	#1
    000000A0 22               [ 8]  194 	ld	(hl+), a
    000000A1 AF               [ 4]  195 	xor	a, a
    000000A2 32               [ 8]  196 	ld	(hl-), a
    000000A3 2A               [ 8]  197 	ld	a, (hl+)
    000000A4 5F               [ 4]  198 	ld	e, a
    000000A5 56               [ 8]  199 	ld	d, (hl)
    000000A6 21 18 00         [12]  200 	ld	hl, #0x0018
    000000A9 7B               [ 4]  201 	ld	a, e
    000000AA 95               [ 4]  202 	sub	a, l
    000000AB 5F               [ 4]  203 	ld	e, a
    000000AC 7A               [ 4]  204 	ld	a, d
    000000AD 9C               [ 4]  205 	sbc	a, h
    000000AE F8 04            [12]  206 	ldhl	sp,	#4
    000000B0 32               [ 8]  207 	ld	(hl-), a
    000000B1 73               [ 8]  208 	ld	(hl), e
    000000B2 2A               [ 8]  209 	ld	a, (hl+)
    000000B3 4F               [ 4]  210 	ld	c, a
    000000B4 46               [ 8]  211 	ld	b, (hl)
    000000B5 CB 7E            [12]  212 	bit	7, (hl)
    000000B7 28 0C            [12]  213 	jr	Z, 00104$
    000000B9 2B               [ 8]  214 	dec	hl
    000000BA 2B               [ 8]  215 	dec	hl
    000000BB 2B               [ 8]  216 	dec	hl
    000000BC 2A               [ 8]  217 	ld	a, (hl+)
    000000BD 5F               [ 4]  218 	ld	e, a
    000000BE 56               [ 8]  219 	ld	d, (hl)
    000000BF 21 EF FF         [12]  220 	ld	hl, #0xffef
    000000C2 19               [ 8]  221 	add	hl, de
    000000C3 4D               [ 4]  222 	ld	c, l
    000000C4 44               [ 4]  223 	ld	b, h
    000000C5                        224 00104$:
    000000C5 CB 28            [ 8]  225 	sra	b
    000000C7 CB 19            [ 8]  226 	rr	c
    000000C9 CB 28            [ 8]  227 	sra	b
    000000CB CB 19            [ 8]  228 	rr	c
    000000CD CB 28            [ 8]  229 	sra	b
    000000CF CB 19            [ 8]  230 	rr	c
    000000D1 79               [ 4]  231 	ld	a, c
    000000D2 87               [ 4]  232 	add	a, a
    000000D3 87               [ 4]  233 	add	a, a
    000000D4 87               [ 4]  234 	add	a, a
    000000D5 81               [ 4]  235 	add	a, c
    000000D6 87               [ 4]  236 	add	a, a
    000000D7 F8 00            [12]  237 	ldhl	sp,	#0
    000000D9 86               [ 8]  238 	add	a, (hl)
                                    239 ;engine.c:67: }
    000000DA E8 06            [16]  240 	add	sp, #6
    000000DC C9               [16]  241 	ret
                                    242 	.area _HOME
                                    243 ;--------------------------------------------------------
                                    244 ; code
                                    245 ;--------------------------------------------------------
                                    246 	.area _CODE
                                    247 	.area _CODE
                                    248 	.area _INITIALIZER
                                    249 	.area _CABS (ABS)
